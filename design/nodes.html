<!DOCTYPE html>
<html lang="zh-CN" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HPC 节点视图</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body class="bg-gray-950 text-gray-100 flex">
  <!-- Sidebar -->
  <aside class="w-64 fixed inset-y-0 left-0 bg-gray-900 border-r border-gray-800 flex flex-col z-50">
    <div class="h-16 flex items-center px-6 border-b border-gray-800">
      <i class="fa-solid fa-server text-indigo-500 text-xl mr-3"></i>
      <span class="font-bold text-lg tracking-wide">HPC Admin</span>
    </div>
    <nav class="flex-1 px-4 py-6 space-y-2">
      <a href="dashboard.html" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-gray-800 hover:text-white rounded-lg transition-colors">
        <i class="fa-solid fa-gauge w-5 text-center"></i>
        <span>总览</span>
      </a>
      <a href="jobs.html" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-gray-800 hover:text-white rounded-lg transition-colors">
        <i class="fa-solid fa-list-check w-5 text-center"></i>
        <span>作业管理</span>
      </a>
      <a href="nodes.html" class="flex items-center gap-3 px-4 py-3 bg-gray-800 text-white rounded-lg transition-colors">
        <i class="fa-solid fa-network-wired w-5 text-center"></i>
        <span>节点管理</span>
      </a>
      <div class="pt-6 mt-6 border-t border-gray-800">
        <div class="px-4 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">系统</div>
        <a href="#" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-gray-800 hover:text-white rounded-lg transition-colors">
          <i class="fa-solid fa-gear w-5 text-center"></i>
          <span>设置</span>
        </a>
      </div>
    </nav>
    <div class="p-4 border-t border-gray-800">
      <div class="flex items-center gap-3 px-4 py-2">
        <img src="https://ui-avatars.com/api/?name=Admin&background=random" class="w-8 h-8 rounded-full">
        <div class="text-sm">
          <div class="font-medium">Administrator</div>
          <div class="text-xs text-gray-500">Online</div>
        </div>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <div class="flex-1 ml-64 min-h-screen flex flex-col">
    <header class="h-16 bg-gray-900/50 backdrop-blur border-b border-gray-800 flex items-center justify-between px-6 sticky top-0 z-40">
      <div class="flex items-center gap-4 text-gray-400 text-sm">
        <span><i class="fa-solid fa-location-dot mr-2"></i>HPC Cluster A</span>
        <span id="cur-part-badge" class="hidden px-2 py-0.5 bg-indigo-900/50 text-indigo-300 rounded text-xs border border-indigo-700/50"></span>
        <span id="cur-job-badge" class="hidden px-2 py-0.5 bg-indigo-900/50 text-indigo-300 rounded text-xs border border-indigo-700/50"></span>
      </div>
      <div class="flex items-center gap-4">
        <div class="flex items-center gap-2 bg-gray-800 rounded px-3 py-1.5 text-sm text-gray-400">
          <i class="fa-solid fa-search"></i>
          <input placeholder="搜索节点ID..." class="bg-transparent outline-none w-48">
        </div>
        <button class="w-8 h-8 rounded-full bg-gray-800 hover:bg-gray-700 flex items-center justify-center transition-colors relative">
          <i class="fa-solid fa-bell text-gray-400 text-sm"></i>
          <span class="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"></span>
        </button>
      </div>
    </header>

    <div class="p-6">
      <div class="flex flex-wrap gap-3 items-end mb-6">
        <div>
          <label class="text-xs text-gray-400">分区</label>
          <select id="flt-part" class="mt-1 bg-gray-800 border border-gray-700 rounded px-3 py-2">
            <option value="all">all</option>
            <option value="gpu-a">gpu-a</option>
            <option value="cpu-b">cpu-b</option>
            <option value="mem-c">mem-c</option>
          </select>
        </div>
        <div>
          <label class="text-xs text-gray-400">健康状态</label>
          <select id="flt-health" class="mt-1 bg-gray-800 border border-gray-700 rounded px-3 py-2">
            <option value="all">全部</option>
            <option value="健康">健康</option>
            <option value="告警">告警</option>
            <option value="离线">离线</option>
          </select>
        </div>
        <div class="flex-1"></div>
        <button id="btn-filter" class="px-3 py-2 bg-gray-800 hover:bg-gray-700 rounded text-sm"><i class="fa-solid fa-filter mr-1"></i>筛选</button>
      </div>

      <div id="cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(location.search);
    const partParam = params.get('part');
    const jobParam = params.get('job');

    if (partParam) {
        document.getElementById('flt-part').value = partParam;
        const b = document.getElementById('cur-part-badge');
        b.textContent = '分区: ' + partParam;
        b.classList.remove('hidden');
    }
    if (jobParam) {
        const b = document.getElementById('cur-job-badge');
        b.textContent = '作业: ' + jobParam;
        b.classList.remove('hidden');
    }

    const nodes = [
      { id:'node-21', part:'gpu-a', health:'健康', cpu:{total:64, free:16}, mem:{total:256, free:64}, gpu:{total:8, free:2}, jobs:['J-102938', 'J-102944'] },
      { id:'node-11', part:'cpu-b', health:'健康', cpu:{total:32, free:20}, mem:{total:256, free:120}, gpu:{total:0, free:0}, jobs:['J-102941'] },
      { id:'node-07', part:'gpu-a', health:'告警', cpu:{total:64, free:8}, mem:{total:256, free:40}, gpu:{total:4, free:0}, jobs:['J-102942'] },
      { id:'node-33', part:'mem-c', health:'离线', cpu:{total:16, free:0}, mem:{total:1024, free:0}, gpu:{total:2, free:0}, jobs:[] },
    ];
    let cur = nodes;

    function render(){
      const cards = document.getElementById('cards');
      if (cur.length === 0) {
        cards.innerHTML = '<div class="col-span-full text-center py-12 text-gray-500">无匹配节点数据</div>';
        return;
      }
      cards.innerHTML = cur.map(n=>`
        <div class="rounded-xl border border-gray-800 bg-gray-900 hover:border-gray-700 transition p-5 group">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-lg bg-gray-800 flex items-center justify-center text-gray-400 group-hover:bg-indigo-500/10 group-hover:text-indigo-400 transition-colors">
                <i class="fa-solid fa-server"></i>
              </div>
              <div>
                <h3 class="font-medium">${n.id}</h3>
                <div class="text-xs text-gray-500">${n.part}</div>
              </div>
            </div>
            <span class="text-xs px-2 py-0.5 rounded border ${n.health==='健康'?'border-emerald-500/20 text-emerald-400 bg-emerald-500/10': n.health==='告警'?'border-yellow-500/20 text-yellow-400 bg-yellow-500/10':'border-gray-700 text-gray-400 bg-gray-800'}">
              ${n.health}
            </span>
          </div>
          
          <div class="space-y-3 text-sm mb-5">
            <div class="flex items-center gap-2">
              <i class="fa-solid fa-microchip text-purple-400 w-4"></i>
              <span class="text-gray-400">CPU</span>
              <div class="flex-1 h-1.5 bg-gray-800 rounded-full overflow-hidden ml-2">
                <div class="h-full bg-purple-500" style="width: ${Math.round((1-n.cpu.free/n.cpu.total)*100)}%"></div>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <i class="fa-solid fa-memory text-blue-400 w-4"></i>
              <span class="text-gray-400">MEM</span>
              <div class="flex-1 h-1.5 bg-gray-800 rounded-full overflow-hidden ml-2">
                <div class="h-full bg-blue-500" style="width: ${Math.round((1-n.mem.free/n.mem.total)*100)}%"></div>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <i class="fa-solid fa-square text-emerald-400 w-4"></i>
              <span class="text-gray-400">GPU</span>
              <div class="flex-1 h-1.5 bg-gray-800 rounded-full overflow-hidden ml-2">
                <div class="h-full bg-emerald-500" style="width: ${n.gpu.total? Math.round((1-n.gpu.free/n.gpu.total)*100): 0}%"></div>
              </div>
            </div>
          </div>

          <div class="flex items-center justify-between pt-4 border-t border-gray-800 text-xs text-gray-400 mb-4">
            <span>运行作业: <span class="text-white font-medium">${n.jobs.length}</span></span>
          </div>

          <div class="flex gap-2">
            <a href="jobs.html?node=${n.id}" class="flex-1 text-center text-xs px-3 py-2 rounded border border-gray-700 hover:bg-gray-800 hover:text-white text-gray-400 transition-colors">
              查看作业
            </a>
            <a href="dashboard.html?part=${n.part}" class="flex-1 text-center text-xs px-3 py-2 rounded border border-gray-700 hover:bg-gray-800 hover:text-white text-gray-400 transition-colors">
              查看分区
            </a>
          </div>
        </div>`).join('');
    }

    function apply(){
      const p = document.getElementById('flt-part').value;
      const h = document.getElementById('flt-health').value;
      cur = nodes.filter(n=> {
        if (jobParam && !n.jobs.includes(jobParam)) return false;
        if (p!=='all' && n.part!==p) return false;
        if (h!=='all' && n.health!==h) return false;
        return true;
      });
      render();
    }
    document.getElementById('btn-filter').addEventListener('click', apply);
    document.getElementById('flt-part').addEventListener('change', apply);
    document.getElementById('flt-health').addEventListener('change', apply);

    apply();
  </script>
</body>
</html>
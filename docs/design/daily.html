<!DOCTYPE html>
<html lang="zh-CN" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HPC 日报展示</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body class="bg-gray-950 text-gray-100 flex">
  <!-- Sidebar -->
  <aside class="w-64 fixed inset-y-0 left-0 bg-gray-900 border-r border-gray-800 flex flex-col z-50">
    <div class="h-16 flex items-center px-6 border-b border-gray-800">
      <i class="fa-solid fa-server text-indigo-500 text-xl mr-3"></i>
      <span class="font-bold text-lg tracking-wide">HPC Admin</span>
    </div>
    <nav class="flex-1 px-4 py-6 space-y-2">
      <a href="dashboard.html" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-gray-800 hover:text-white rounded-lg transition-colors">
        <i class="fa-solid fa-gauge w-5 text-center"></i>
        <span>总览</span>
      </a>
      <a href="jobs.html" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-gray-800 hover:text-white rounded-lg transition-colors">
        <i class="fa-solid fa-list-check w-5 text-center"></i>
        <span>作业管理</span>
      </a>
      <a href="nodes.html" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-gray-800 hover:text-white rounded-lg transition-colors">
        <i class="fa-solid fa-network-wired w-5 text中心"></i>
        <span>节点管理</span>
      </a>
      <a href="daily.html" class="flex items-center gap-3 px-4 py-3 bg-gray-800 text-white rounded-lg transition-colors">
        <i class="fa-solid fa-calendar-day w-5 text中心"></i>
        <span>日报</span>
      </a>
    </nav>
    <div class="p-4 border-t border-gray-800">
      <div class="flex items-center gap-3 px-4 py-2">
        <img src="https://ui-avatars.com/api/?name=Admin&background=random" class="w-8 h-8 rounded-full">
        <div class="text-sm">
          <div class="font-medium">Administrator</div>
          <div class="text-xs text-gray-500">Online</div>
        </div>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <div class="flex-1 ml-64 min-h-screen flex flex-col">
    <header class="h-16 bg-gray-900/50 backdrop-blur border-b border-gray-800 flex items中心 justify-between px-6 sticky top-0 z-40">
      <div class="flex items中心 gap-4 text-gray-400 text-sm">
        <span><i class="fa-solid fa-location-dot mr-2"></i>HPC Cluster A</span>
      </div>
      <div class="flex items中心 gap-4">
        <label class="text-xs text-gray-400">日期</label>
        <select id="report-date" class="bg-gray-800 border border-gray-700 rounded px-3 py-2"></select>
      </div>
    </header>

    <div class="p-6 space-y-6">
      <section class="relative rounded-xl overflow-hidden">
        <!-- 图片来源: https://images.unsplash.com/photo-1518770660439-4636190af475 -->
        <img src="https://images.unsplash.com/photo-1518770660439-4636190af475?q=80&w=1400&auto=format&fit=crop" alt="servers" class="w-full h-48 object-cover opacity-40">
        <div class="absolute inset-0 flex items中心 px-6 bg-gradient-to-r from-gray-900/80 to-transparent">
          <div class="space-y-2">
            <h1 class="text-2xl font-semibold">集群日报</h1>
            <p class="text-gray-300">按日汇总资源利用、用户与异常情况。</p>
          </div>
        </div>
      </section>

      <section class="bg-gray-900 rounded-xl p-6 border border-gray-800">
        <div class="flex items中心 justify-between mb-4">
          <h2 class="font-medium">资源统计（分区维度）</h2>
          <span id="date-label" class="text-xs text-gray-400"></span>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead class="bg-gray-800/50 text-gray-400">
              <tr>
                <th class="px-4 py-3 text-left">分区</th>
                <th class="px-4 py-3 text-left">运行作业数</th>
                <th class="px-4 py-3 text-left">排队数</th>
                <th class="px-4 py-3 text-left">成功率</th>
                <th class="px-4 py-3 text-left">CPU分配率</th>
                <th class="px-4 py-3 text-left">内存分配率</th>
                <th class="px-4 py-3 text-left">GPU分配率</th>
                <th class="px-4 py-3 text-left">正常节点/总节点</th>
              </tr>
            </thead>
            <tbody id="part-body" class="divide-y divide-gray-800"></tbody>
          </table>
        </div>
      </section>

      <section class="bg-gray-900 rounded-xl p-6 border border-gray-800">
        <div class="flex items中心 justify-between mb-4">
          <h2 class="font-medium">用户统计</h2>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
          <div class="rounded-lg border border-gray-800 bg-gray-900 p-4 text-center">
            <div class="text-xs text-gray-400 mb-1">总用户数</div>
            <div id="user-total" class="text-2xl font-semibold">-</div>
          </div>
          <div class="rounded-lg border border-gray-800 bg-gray-900 p-4 text-center">
            <div class="text-xs text-gray-400 mb-1">在线用户数</div>
            <div id="user-online" class="text-2xl font-semibold text-emerald-400">-</div>
          </div>
        </div>
      </section>

      <section class="bg-gray-900 rounded-xl p-6 border border-gray-800">
        <div class="flex items中心 justify-between mb-4">
          <h2 class="font-medium">异常情况</h2>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div>
            <h3 class="text-sm text-gray-400 mb-2">异常节点</h3>
            <div id="bad-nodes" class="space-y-2"></div>
          </div>
          <div>
            <h3 class="text-sm text-gray-400 mb-2">排队作业明细</h3>
            <div class="overflow-hidden border border-gray-800 rounded-xl bg-gray-900">
              <table class="min-w-full text-xs">
                <thead class="bg-gray-800/50 text-gray-400">
                  <tr>
                    <th class="px-3 py-2 text-left">作业ID</th>
                    <th class="px-3 py-2 text-left">申请人</th>
                    <th class="px-3 py-2 text-left">分区</th>
                    <th class="px-3 py-2 text-left">CPU/MEM/GPU</th>
                    <th class="px-3 py-2 text-left">排队时长</th>
                  </tr>
                </thead>
                <tbody id="queue-body" class="divide-y divide-gray-800"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <script>
    function fmtPct(v){ return (Math.round(v*100)) + '%'; }

    function lastNDates(n){
      const res = [];
      const d = new Date();
      for (let i=n-1;i>=0;i--){
        const t = new Date(d.getFullYear(), d.getMonth(), d.getDate()-i);
        const s = t.toISOString().slice(0,10);
        res.push(s);
      }
      return res;
    }

    function seededRandom(seed){
      let h = 0;
      for (let i=0;i<seed.length;i++){ h = (h*31 + seed.charCodeAt(i)) >>> 0; }
      return ()=>{ h = (h*1103515245 + 12345) & 0x7fffffff; return (h/0x7fffffff); };
    }

    function genData(date){
      const rnd = seededRandom(date);
      const parts = ['gpu-a','cpu-b','mem-c'];
      const partRows = parts.map(p=>{
        const run = Math.floor(rnd()*50)+10;
        const que = Math.floor(rnd()*20);
        const succ = 0.85 + rnd()*0.14; // 85%~99%
        const cpu = 0.4 + rnd()*0.5;
        const mem = 0.3 + rnd()*0.6;
        const gpu = p==='gpu-a' ? 0.3 + rnd()*0.6 : 0;
        const totalNodes = 12 + Math.floor(rnd()*28);
        const healthyNodes = Math.max(1, Math.floor(totalNodes * (0.85 + rnd()*0.15)));
        return { part:p, run, que, succ, cpu, mem, gpu, healthyNodes, totalNodes };
      });

      const userTotal = 300 + Math.floor(rnd()*100);
      const userOnline = Math.floor(userTotal * (0.15 + rnd()*0.25));

      const badNodes = [];
      ['node-07','node-33','node-54','node-88'].forEach(n=>{
        if (rnd()>0.6) badNodes.push({ id:n, part: parts[Math.floor(rnd()*parts.length)], reason: rnd()>0.5? '心跳丢失':'温度告警' });
      });

      const queuedJobs = Array.from({length: Math.floor(rnd()*6)+3}).map((_,i)=>{
        const id = 'Q-' + date.slice(2).replaceAll('-','') + '-' + (100+i);
        const part = parts[Math.floor(rnd()*parts.length)];
        const cpu = [4,8,16,32,64][Math.floor(rnd()*5)];
        const mem = [16,32,64,128,256][Math.floor(rnd()*5)];
        const gpu = part==='gpu-a'? [0,1,2,4][Math.floor(rnd()*4)] : 0;
        const user = ['alice','bob','carol','dave','eve'][Math.floor(rnd()*5)];
        const dur = Math.floor(rnd()*180)+15;
        return { id, user, part, cpu, mem, gpu, dur };
      });

      return { partRows, userTotal, userOnline, badNodes, queuedJobs };
    }

    function render(date){
      const d = genData(date);
      document.getElementById('date-label').textContent = date;
      const pb = document.getElementById('part-body');
      pb.innerHTML = d.partRows.map(r=>`
        <tr class="hover:bg-gray-800/50 transition-colors">
          <td class="px-4 py-3">${r.part}</td>
          <td class="px-4 py-3 text-gray-300">${r.run}</td>
          <td class="px-4 py-3 text-gray-300">${r.que}</td>
          <td class="px-4 py-3"><span class="inline-flex items中心 gap-1.5 px-2 py-0.5 rounded text-xs border ${r.succ>0.95?'bg-emerald-500/10 text-emerald-400 border-emerald-500/20':r.succ>0.9?'bg-yellow-500/10 text-yellow-400 border-yellow-500/20':'bg-red-500/10 text-red-400 border-red-500/20'}">${fmtPct(r.succ)}</span></td>
          <td class="px-4 py-3 text-gray-400">${fmtPct(r.cpu)}</td>
          <td class="px-4 py-3 text-gray-400">${fmtPct(r.mem)}</td>
          <td class="px-4 py-3 text-gray-400">${r.gpu? fmtPct(r.gpu): '-'}</td>
          <td class="px-4 py-3 text-gray-400">${r.healthyNodes}/${r.totalNodes}</td>
        </tr>
      `).join('');

      document.getElementById('user-total').textContent = d.userTotal;
      document.getElementById('user-online').textContent = d.userOnline;

      const bn = document.getElementById('bad-nodes');
      bn.innerHTML = d.badNodes.length? d.badNodes.map(n=>`
        <div class="flex items中心 justify-between rounded border border-gray-800 bg-gray-900 px-3 py-2">
          <div class="flex items中心 gap-2"><i class="fa-solid fa-triangle-exclamation text-yellow-400"></i><span class="text-gray-300">${n.id}</span><span class="text-xs text-gray-500">${n.part}</span></div>
          <span class="text-xs text-red-400">${n.reason}</span>
        </div>
      `).join('') : '<div class="text-xs text-gray-500">无异常节点</div>';

      const qb = document.getElementById('queue-body');
      qb.innerHTML = d.queuedJobs.map(q=>`
        <tr class="hover:bg-gray-800/50 transition-colors">
          <td class="px-3 py-2 font-mono">${q.id}</td>
          <td class="px-3 py-2">${q.user}</td>
          <td class="px-3 py-2">${q.part}</td>
          <td class="px-3 py-2 text-gray-400">${q.cpu}C/${q.mem}G/${q.gpu}G</td>
          <td class="px-3 py-2 text-gray-400">${q.dur} min</td>
        </tr>
      `).join('');
    }

    const dates = lastNDates(7);
    const sel = document.getElementById('report-date');
    dates.forEach(d=>{ const o=document.createElement('option'); o.value=d; o.textContent=d; sel.appendChild(o); });
    sel.value = dates[dates.length-1];
    document.getElementById('date-label').textContent = sel.value;
    sel.addEventListener('change', ()=> render(sel.value));

    render(sel.value);
  </script>
</body>
</html>
